<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Upload Foto Telegram WebApp</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 40px 20px;
        background: #f9f9f9;
        color: #222;
    }
    .header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 30px;
    }
    .logo-home {
        font-size: 50px;
        color: #0088cc;
    }
    .menu-buttons {
        margin-top: 15px;
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    button {
        padding: 12px 24px;
        font-size: 16px;
        background-color: #0088cc;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: background-color 0.3s ease;
    }
    button:hover {
        background-color: #006699;
    }
    #fotoPreview {
        margin-top: 30px;
        max-width: 90vw;
        max-height: 60vh;
        border-radius: 12px;
        box-shadow: 0 0 12px rgba(0,0,0,0.1);
        object-fit: contain;
        /* pastikan gambar tidak miring */
        transform: none !important;
    }
    #message {
        margin-top: 20px;
        color: #cc0000;
        font-weight: bold;
    }
</style>
<!-- Telegram WebApp JS -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<div class="header">
    <div class="logo-home" title="Logo Rumah">üè†</div>
    <div class="menu-buttons" id="menuButtons">
        <!-- Tombol menu utama dan upload akan muncul di sini -->
    </div>
</div>

<div id="content">
    <p>Memeriksa akses...</p>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const allowedUserId = 7998861975;
    let uploadedImageSrc = null;

    function init() {
        let user = tg.initDataUnsafe.user;

        if (!user) {
            document.getElementById('content').innerHTML = '<p>Gagal mendapatkan data user Telegram.</p>';
            return;
        }

        setupMenu(user.id);

        if (user.id === allowedUserId) {
            showUploadUI();
        } else {
            document.getElementById('content').innerHTML = '<p id="message">Maaf, Anda tidak memiliki izin untuk upload foto.</p>';
        }
    }

    function setupMenu(userId) {
        const menuDiv = document.getElementById('menuButtons');
        menuDiv.innerHTML = '';

        // Tombol Menu Utama (selalu tampil)
        const mainBtn = document.createElement('button');
        mainBtn.textContent = 'MENU UTAMA';
        mainBtn.onclick = () => {
            showMainMenu();
        };
        menuDiv.appendChild(mainBtn);

        // Tombol Upload hanya untuk user terpilih
        if (userId === allowedUserId) {
            const uploadBtn = document.createElement('button');
            uploadBtn.innerHTML = 'üîÑ UPLOAD';
            uploadBtn.id = 'uploadBtn';
            uploadBtn.onclick = () => {
                document.getElementById('fileInput').click();
            };
            menuDiv.appendChild(uploadBtn);
        }
    }

    // Fungsi tampilkan UI upload file dan preview
    function showUploadUI() {
        // Buat input file tersembunyi
        if (!document.getElementById('fileInput')) {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.id = 'fileInput';
            fileInput.style.display = 'none';
            fileInput.addEventListener('change', handleFileChange);
            document.body.appendChild(fileInput);
        }

        // Tampilkan pesan info di content (atau kosongkan)
        document.getElementById('content').innerHTML = '';
    }

    function handleFileChange(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
            alert('Mohon pilih file gambar!');
            return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
            uploadedImageSrc = e.target.result;
            showMainMenu();
        };
        reader.readAsDataURL(file);
    }

    // Fungsi untuk menampilkan menu utama dan preview hasil upload
    function showMainMenu() {
        const content = document.getElementById('content');

        let html = `<h2>Selamat datang di Menu Utama</h2>`;

        if (uploadedImageSrc) {
            html += `<p>Foto yang Anda upload:</p>
                     <img id="fotoPreview" src="${uploadedImageSrc}" alt="Foto Upload" />`;
        } else {
            html += `<p>Belum ada foto yang diupload.</p>`;
        }

        content.innerHTML = html;
    }

    window.onload = init;
</script>

</body>
</html>